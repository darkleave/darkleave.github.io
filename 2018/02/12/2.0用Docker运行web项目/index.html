<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="docker," />





  <link rel="alternate" href="/atom.xml" title="静默的魔法书" type="application/atom+xml" />






<meta name="description" content="在1.0运行你的第一个容器中我们已经顺利让docker运行起来，并且熟悉了一些术语的含义.通过这些基础，我们终于可以实践一些更有意义的东西——用Docker部署web项目.">
<meta name="keywords" content="docker">
<meta property="og:type" content="article">
<meta property="og:title" content="2.0用Docker运行web项目">
<meta property="og:url" content="http://www.zhz.gift/2018/02/12/2.0用Docker运行web项目/index.html">
<meta property="og:site_name" content="静默的魔法书">
<meta property="og:description" content="在1.0运行你的第一个容器中我们已经顺利让docker运行起来，并且熟悉了一些术语的含义.通过这些基础，我们终于可以实践一些更有意义的东西——用Docker部署web项目.">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2018-02-12T03:03:44.797Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="2.0用Docker运行web项目">
<meta name="twitter:description" content="在1.0运行你的第一个容器中我们已经顺利让docker运行起来，并且熟悉了一些术语的含义.通过这些基础，我们终于可以实践一些更有意义的东西——用Docker部署web项目.">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: 'MZF9ZS9GXL',
      apiKey: '71b4ec727c0816672d93fec5d3747c8f',
      indexName: 'darkleave',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://www.zhz.gift/2018/02/12/2.0用Docker运行web项目/"/>





  <title>2.0用Docker运行web项目 | 静默的魔法书</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  
    

  
  
  
  <link rel="stylesheet" href="/lib/algolia-instant-search/instantsearch.min.css">

  
  
  <script src="/lib/algolia-instant-search/instantsearch.min.js"></script>
  

  <script type="text/javascript" src="/js/src/algolia.js?v=5.1.4"></script>

  
  
  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">静默的魔法书</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">零</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  
  <div class="algolia-popup popup search-popup">
    <div class="algolia-search">
      <div class="algolia-search-input-icon">
        <i class="fa fa-search"></i>
      </div>
      <div class="algolia-search-input" id="algolia-search-input"></div>
    </div>

    <div class="algolia-results">
      <div id="algolia-stats"></div>
      <div id="algolia-hits"></div>
      <div id="algolia-pagination" class="algolia-pagination"></div>
    </div>

    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
  </div>




    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.zhz.gift/2018/02/12/2.0用Docker运行web项目/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Hans Chung">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="静默的魔法书">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">2.0用Docker运行web项目</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-02-12T11:07:42+08:00">
                2018-02-12
              </time>
            

            

            
          </span>

          

          
            
          

          
          
             <span id="/2018/02/12/2.0用Docker运行web项目/" class="leancloud_visitors" data-flag-title="2.0用Docker运行web项目">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>在<a href="">1.0运行你的第一个容器</a>中我们已经顺利让docker运行起来，并且熟悉了一些术语的含义.通过这些基础，我们终于可以实践一些更有意义的东西——用Docker部署web项目.</p>
<a id="more"></a>
<h2 id="在容器中运行静态web网站"><a href="#在容器中运行静态web网站" class="headerlink" title="在容器中运行静态web网站"></a>在容器中运行静态web网站</h2><p>Note: 本节示例网站文件请点击<a href="https://github.com/docker/labs/tree/master/beginner/static-site" target="_blank" rel="external">这里</a>.</p>
<p>让我们从初始步骤开始.首先,我们使用Docker在容器中运行一个静态网站.这个网站是基于一个已存在的镜像.我们将从Docker Store拉取Docker镜像，运行容器，并且看到它是怎么建立 web server的.</p>
<p>你将要使用的镜像是一个单页网站，并且为了这个demo示范，已经创建完毕并且在Docker Store中可用，存储路径为dockersamples/static-site.你可以直接使用docker run命令下载并且运行这个镜像.如下:</p>
<pre><code>$ docker run -d dockersamples/static-site
</code></pre><p>Note: 这个当前版本的镜像必须添加-d 标识符才能运行.-d 标识符能够开启<strong>detached</strong>模式,它能从terminal/shell 终端 分派运行中的容器并且在容器启动后返回提示.我们正在调试这个镜像，至于现在，使用-d，即使它是你的第一个例子..(<del>好屌</del>)</p>
<p>该命令运行后,首先由于该镜像并不存在于你的主机上,所以Docker守护进程首先会从registry(Docker store)尝试拉取它然后再让它以容器的方式运行起来.</p>
<p>服务器运行起来后，如何访问网站？网站在哪个端口上运行？更重要的是,如何在我们的主机机器上面直接访问容器.</p>
<p>事实上，你可能还回答不了其中任意一个问题:)(<del>好想打死你</del>),在这种情况下,客户端并未告诉Docker Engine 去发布任何端口,所以你需要重新运行docker run命令去添加这个命令.</p>
<p>让我们重新运行命令，并添加一些新标识符去发布端口并且传递你的名字给容器，以自定义展示的信息.我们将会再次使用-d 选项在detached mode下运行容器.</p>
<p>首先，通过<strong>container ID</strong>停止你正在运行的容器.</p>
<p>因为之前我们已经在detached mode下运行容器,所以我们不需要开启其它的terminal来完成终止操作.运行<strong>docker ps</strong>命令来查看运行中的容器.</p>
<pre><code>$ docker ps
CONTAINER ID        IMAGE                  COMMAND                  CREATED             STATUS              PORTS               NAMES
a7a0e504ca3e        dockersamples/static-site   &quot;/bin/sh -c &apos;cd /usr/&quot;   28 seconds ago      Up 26 seconds       80/tcp, 443/tcp     stupefied_mahavira
</code></pre><p>检查CONTAINER ID那一列.接下来通过CONTAINER ID来停止运行中的容器,并且移除掉它.</p>
<pre><code>$ docker stop a7a0e504ca3e
$ docker rm   a7a0e504ca3e 
</code></pre><p>Note: 一个很cool的特性是你不需要指定整个CONTAINER ID.你可以只指定CONTAINER ID初始的几个字符，并且如果这几个字符在所有你运行的容器当中是唯一的话，那么Docker 客户端会自动获取到该容器.</p>
<pre><code>$ docker run --name static-site -e AUTHOR=&quot;Your Name&quot; -d -P dockersamples/static-site
e61d12292d69556eabe2a44c16cbd54486b2527e2ce4f95438e504afb7b02810
</code></pre><p>在上面的命令当中:</p>
<ul>
<li>-d 将会从我们的terminal以detached模式创建容器.</li>
<li>-P 将会发布所有暴露的容器端口到Docker主机的随机端口上.</li>
<li>-e 是你传递环境变量(environment variables)给容器的方式</li>
<li>–name 允许你指定一个容器的名字 </li>
<li>AUTHOR 是环境变量的名字并且”Your Name” 可以由你进行自定义.</li>
</ul>
<p>现在你可以通过<strong>docker port</strong>命令看到端口了.</p>
<pre><code>$ docker port static-site
443/tcp -&gt; 0.0.0.0:32772
80/tcp -&gt; 0.0.0.0:32773
</code></pre><p>如果你正在运行的是<strong>Docker for Mac</strong>,<strong>Docker for Windows</strong>,或者<strong>Docker on Linux</strong>,你可以打开 <a href="http://localhost:[YOUR_PORT_FOR" target="_blank" rel="external">http://localhost:[YOUR_PORT_FOR</a> 80/tcp].在我们的例子中就是<a href="http://localhost:32773" target="_blank" rel="external">http://localhost:32773</a>.</p>
<p>如果你是在Mac或者Windows上面使用Docker机器，你可以通过<strong>docker-machine</strong>命令行找到hostname.如下(假设你使用的是默认机器)</p>
<pre><code>$ docker-machine ip default
192.168.99.100
</code></pre><p>你可以打开 http://<your_ipaddress>:[YOUR_PORT_FOR 80/tcp] 去访问的网站.在我们的例子中就是:<a href="http://192.168.99.100:32773" target="_blank" rel="external">http://192.168.99.100:32773</a>.</your_ipaddress></p>
<p>你可以在同一时间运行第二个web服务器，制定一个自定义的host端口去映射你的对应容器的webserver.</p>
<pre><code>$ docker run --name static-site-2 -e AUTHOR=&quot;Your Name&quot; -d -p 8888:80 dockersamples/static-site
</code></pre><p>部署它在一个真正的服务器上，你只需要安装Docker，并且通过上述docker命令运行(就像在这个例子中你可以看到AUTHOR是你传递给Docker的那个环境变量)</p>
<p>现在你已经知道了如何在一个Docker容器当中运行webserver，如何创建你自己的Docker镜像？这将是我们在下一小节当中探索的问题.</p>
<p>但现在首先停止并移除容器.</p>
<pre><code>$ docker stop static-site
</code></pre><p>$ docker rm static-site</p>
<p>使用简略语法移除第二个网站:</p>
<pre><code>$ docker rm -f static-site-2
</code></pre><p>运行<strong>docker ps</strong>命令确认容器已经正确停止了.</p>
<h2 id="Docker-镜像"><a href="#Docker-镜像" class="headerlink" title="Docker 镜像"></a>Docker 镜像</h2><p>在这个小节中，让我们更加深入的了解Docker images究竟是什么东西.你将会建立自己的镜像，使用这个镜像在你的本地运行一个应用，然后最终，推送一些你自己的镜像到Docker Cloud.</p>
<p>Docker images 是容器的基础.在上一个例子中,你从registry(docker store)拉取 dockersamples/static-site 镜像并且让Docker 客户端基于这个镜像运行一个容器.通过运行<strong>docker images</strong>命令来查看你系统上本地可用的镜像列表.</p>
<pre><code>$ docker images
REPOSITORY             TAG                 IMAGE ID            CREATED             SIZE
dockersamples/static-site   latest              92a386b6e686        2 hours ago        190.5 MB
nginx                  latest              af4b3d7d5401        3 hours ago        190.5 MB
python                 2.7                 1c32174fd534        14 hours ago        676.8 MB
postgres               9.4                 88d845ac7a88        14 hours ago        263.6 MB
containous/traefik     latest              27b4e0c6b2fd        4 days ago          20.75 MB
node                   0.10                42426a5cba5f        6 days ago          633.7 MB
redis                  latest              4f5f397d4b7c        7 days ago          177.5 MB
mongo                  latest              467eb21035a8        7 days ago          309.7 MB
alpine                 3.3                 70c557e50ed6        8 days ago          4.794 MB
java                   7                   21f6ce84e43c        8 days ago          587.7 MB
</code></pre><p>上述是我从registry拉取的一系列镜像,以及一些我自己创建的(我们很快会看到如何做的).在你的机器上可能是一个不同的镜像列表.TAG 指的是这个镜像特别的snapshot 快照版本，ID则是这个镜像唯一的标识.</p>
<p>简单地说，你可以把一个镜像理解为类似git仓库的东西，镜像可以像git一样提交commit并且有多个版本.当你没有提供一个指定的版本，客户端默认会是最新的.</p>
<p>例如，你可以指定一个特定版本的ubuntu镜像如下所示:</p>
<pre><code>$ docker pull ubuntu:12.04
</code></pre><p>如果你没有指定一个特定版本的镜像,就像提到的那样,Dcoker 客户端将会默认选择最新版本的.</p>
<p>如例子所示,docker 将会拉取一个命名为: ubuntu:latest 的镜像:</p>
<pre><code>$ docker pull ubuntu
</code></pre><p>获取Docker image的途径，一是从registry(就比如Docker Store),二是自己创建.在Docker Store中有成百上千的镜像等你临幸.或者你也可以直接通过<strong>docker search</strong>命令来搜索镜像.</p>
<p>镜像之间的一个重要区别是关于 base images(基础镜像)和child images(子镜像).</p>
<ul>
<li><p>Base images 没有父级镜像,通常是操作系统的镜像，像ubuntu,alpine 或者debian.</p>
</li>
<li><p>Child images 是在base images的基础上构建起来的，通常添加了一些额外的功能.</p>
</li>
</ul>
<p>另一个关键概念是 official images (官方镜像) 和 user images(用户镜像).<br>(它们都可以是基础镜像或者子镜像)</p>
<ul>
<li>Official images 是Docker 官方审核认可的 镜像.Docker,一个负责审核和发布所有官方仓库内容的团队.上述的一系列镜像,python,node,alpine 和 nginx镜像都是官方(base)镜像.通过查看官方镜像文档来了解更多官方镜像.(<a href="https://docs.docker.com/docker-hub/official_repos/" target="_blank" rel="external">official Images Documentation</a>)</li>
<li>User images 是由用户创建和共享的镜像.它们是在base images的基础上构建并添加额外的功能.典型的它们都是以 <strong>user/image-name</strong>格式来命名.用户名一般是你的Docker Store用户名或者组织名.</li>
</ul>
<h2 id="创建你的首个镜像"><a href="#创建你的首个镜像" class="headerlink" title="创建你的首个镜像"></a>创建你的首个镜像</h2><p>Note: 这个小节的示例代码在<a href="https://github.com/docker/labs/tree/master/beginner/flask-app" target="_blank" rel="external">flask-app</a> 路径下的仓库.</p>
<p>现在你已经对镜像有了进一步的理解了，是时候创建你自己的镜像了.我们的目标是创建一个镜像并在沙盒中运行一个<a href="http://flask.pocoo.org/" target="_blank" rel="external">Flash</a>应用.</p>
<p>这个练习的目的是创建一个Docker镜像并运行一个Flask app.</p>
<p>我们首先一次性领取一个用Python Flask构建的随机生成猫图片的组件，然后通过编写一个Dockerfile 来<strong>dockerizing</strong>它.最后,我们构建镜像,然后运行它.</p>
<p>具体步骤如下:</p>
<ul>
<li>创建一个展示随机猫图片的Python Flask app.</li>
<li>编写一个Dockerfile文件</li>
<li>构建镜像</li>
<li>运行镜像</li>
<li>Dockerfile 命令总结</li>
</ul>
<h3 id="创建一个展示随机猫图片的Python-Flask-app"><a href="#创建一个展示随机猫图片的Python-Flask-app" class="headerlink" title="创建一个展示随机猫图片的Python Flask app"></a>创建一个展示随机猫图片的Python Flask app</h3><p>创建一个flask-app目录,然后在该目录下创建以下文件:</p>
<ul>
<li>app.py</li>
<li>requirements.txt</li>
<li>templates/index.html</li>
<li>Dockerfile</li>
</ul>
<h3 id="app-py"><a href="#app-py" class="headerlink" title="app.py"></a>app.py</h3><p>用以下内容创建app.py:</p>
<pre><code>from flask import Flask, render_template
import random

app = Flask(__name__)

# list of cat images
images = [
    &quot;http://ak-hdl.buzzfed.com/static/2013-10/enhanced/webdr05/15/9/anigif_enhanced-buzz-26388-1381844103-11.gif&quot;,
    &quot;http://ak-hdl.buzzfed.com/static/2013-10/enhanced/webdr01/15/9/anigif_enhanced-buzz-31540-1381844535-8.gif&quot;,
    &quot;http://ak-hdl.buzzfed.com/static/2013-10/enhanced/webdr05/15/9/anigif_enhanced-buzz-26390-1381844163-18.gif&quot;,
    &quot;http://ak-hdl.buzzfed.com/static/2013-10/enhanced/webdr06/15/10/anigif_enhanced-buzz-1376-1381846217-0.gif&quot;,
    &quot;http://ak-hdl.buzzfed.com/static/2013-10/enhanced/webdr03/15/9/anigif_enhanced-buzz-3391-1381844336-26.gif&quot;,
    &quot;http://ak-hdl.buzzfed.com/static/2013-10/enhanced/webdr06/15/10/anigif_enhanced-buzz-29111-1381845968-0.gif&quot;,
    &quot;http://ak-hdl.buzzfed.com/static/2013-10/enhanced/webdr03/15/9/anigif_enhanced-buzz-3409-1381844582-13.gif&quot;,
    &quot;http://ak-hdl.buzzfed.com/static/2013-10/enhanced/webdr02/15/9/anigif_enhanced-buzz-19667-1381844937-10.gif&quot;,
    &quot;http://ak-hdl.buzzfed.com/static/2013-10/enhanced/webdr05/15/9/anigif_enhanced-buzz-26358-1381845043-13.gif&quot;,
    &quot;http://ak-hdl.buzzfed.com/static/2013-10/enhanced/webdr06/15/9/anigif_enhanced-buzz-18774-1381844645-6.gif&quot;,
    &quot;http://ak-hdl.buzzfed.com/static/2013-10/enhanced/webdr06/15/9/anigif_enhanced-buzz-25158-1381844793-0.gif&quot;,
    &quot;http://ak-hdl.buzzfed.com/static/2013-10/enhanced/webdr03/15/10/anigif_enhanced-buzz-11980-1381846269-1.gif&quot;
]

@app.route(&apos;/&apos;)
def index():
    url = random.choice(images)
    return render_template(&apos;index.html&apos;, url=url)

if __name__ == &quot;__main__&quot;:
    app.run(host=&quot;0.0.0.0&quot;)
</code></pre><h3 id="requirements-txt"><a href="#requirements-txt" class="headerlink" title="requirements.txt"></a>requirements.txt</h3><p>为了为我们的app安装所需的Python模块,我们需要创建一个requirements.txt文件并且添加如下内容:</p>
<pre><code>Flask==0.10.1      
</code></pre><h3 id="templates-index-html"><a href="#templates-index-html" class="headerlink" title="templates/index.html"></a>templates/index.html</h3><p>创建一个命名为templates的目录并且在其中创建一个index.html 文件，具体内容如下:</p>
<pre><code>&lt;html&gt;
  &lt;head&gt;
    &lt;style type=&quot;text/css&quot;&gt;
      body {
        background: black;
        color: white;
      }
      div.container {
        max-width: 500px;
        margin: 100px auto;
        border: 20px solid white;
        padding: 10px;
        text-align: center;
      }
      h4 {
        text-transform: uppercase;
      }
    &lt;/style&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;div class=&quot;container&quot;&gt;
      &lt;h4&gt;Cat Gif of the day&lt;/h4&gt;
      &lt;img src=&quot;{{url}}&quot; /&gt;
      &lt;p&gt;&lt;small&gt;Courtesy: &lt;a href=&quot;http://www.buzzfeed.com/copyranter/the-best-cat-gif-post-in-the-history-of-cat-gifs&quot;&gt;Buzzfeed&lt;/a&gt;&lt;/small&gt;&lt;/p&gt;
    &lt;/div&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre><h2 id="编写一个Dockerfile文件"><a href="#编写一个Dockerfile文件" class="headerlink" title="编写一个Dockerfile文件"></a>编写一个Dockerfile文件</h2><p>我们想要为这个web app创建一个Docker镜像.就像上述提到的,所有的用户镜像都是基于基础镜像.因为我们的应用是用Python编写的,我们将会在Alpine的基础上构建我们的Python镜像.完成这一点我们需要使用一个Dockerfile.</p>
<p><a href="https://docs.docker.com/engine/reference/builder/" target="_blank" rel="external">Dockerfile</a>实际上只是一个包含了一系列docker指令的text文件,当创建镜像的时候,docker 守护进程会从后台调用.Dockerfile包含了所有Docker应该如何去运行这个app的所有信息 - 一个基础Docker 镜像从哪里运行,你项目代码的路径,它拥有的所有依赖 和启动是运行的命令.这是一个镜像创建过程自动化的最普遍方式.这种方式最大的优点是你在Dockerfile编写的<a href="https://docs.docker.com/engine/reference/builder/" target="_blank" rel="external">命令</a>完全等同于它们的linux命令.这意味着你不用去学习新的语法来创建你的Dockerfile文件.</p>
<p>1.创建一个命名为Dockerfile的文件,并添加如下描述内容.</p>
<p>我们将通过<strong>From</strong>关键字指令指定我们的基础镜像:</p>
<pre><code>FROM alpine:3.5
</code></pre><p>2.下一步骤通常是编写复制文件和安装依赖的指令.但首先我们需要安装Python pip 包 到alpine linux发布版本.其它依赖安装也是同样，包括python interpreter 解释器.添加如下<a href="https://docs.docker.com/engine/reference/builder/#run" target="_blank" rel="external">RUN</a>命令:</p>
<pre><code>RUN apk add --update py2-pip
</code></pre><p>3.添加 Flask Application的组成文件</p>
<p>安装所有我们app运行所需的Python requirements.通过以下命令完成:</p>
<pre><code>COPY requirements.txt /usr/src/app/
RUN pip install --no-cache-dir -r /usr/src/app/requirements.txt
</code></pre><p>通过<a href="https://docs.docker.com/engine/reference/builder/#copy" target="_blank" rel="external">COPY</a> 命令复制你早期创建的文件到我们的镜像当中.</p>
<pre><code>COPY app.py /usr/src/app/
COPY templates/index.html /usr/src/app/templates/
</code></pre><p>4.指定需要暴露的接口.flask app运行的端口是5000.</p>
<pre><code>EXPOSE 5000
</code></pre><p>5.最后的步骤是运行我们的应用-<strong>python ./app.py</strong>.使用<a href="https://docs.docker.com/engine/reference/builder/#cmd" target="_blank" rel="external">CMD</a>指令:</p>
<pre><code>CMD [&quot;python&quot;, &quot;/usr/src/app/app.py&quot;]
</code></pre><p>CMD命令的主要目的是告诉容器当它启动时默认应该运行哪些指令.</p>
<p>6.验证你的Dockerfile文件.</p>
<p>我们的Dockerfile文件终于准备好了.内容汇总如下:</p>
<pre><code># our base image
FROM alpine:3.5

# Install python and pip
RUN apk add --update py2-pip

# install Python modules needed by the Python app
COPY requirements.txt /usr/src/app/
RUN pip install --no-cache-dir -r /usr/src/app/requirements.txt

# copy files required for the app to run
COPY app.py /usr/src/app/
COPY templates/index.html /usr/src/app/templates/

# tell the port number the container should expose
EXPOSE 5000

# run the application
CMD [&quot;python&quot;, &quot;/usr/src/app/app.py&quot;]
</code></pre><h3 id="构建镜像"><a href="#构建镜像" class="headerlink" title="构建镜像"></a>构建镜像</h3><p>现在你已经有了自己的Dockerfile,你可以构建自己的镜像.<strong>docker build</strong>命令依据Dockerfile完成创建docker image的一系列复杂任务.</p>
<p>当你运行以下的<strong>docker build</strong>命令,确保用你的用户名去替换 <strong><your_username></your_username></strong> .这个用户名必须跟你在<a href="https://cloud.docker.com/" target="_blank" rel="external">Docker Cloud</a>注册创建的用户名保持一致.如果你还没有完成这一步,请先到Docker Cloud创建一个账户.</p>
<p><strong>docker build</strong> 命令相当简单 - 它提供一个可选的-t 参数 和包含Dockerfile文件的路径 - <strong>.</strong> 表明当前路径:</p>
<pre><code>$ docker build -t &lt;YOUR_USERNAME&gt;/myfirstapp .
Sending build context to Docker daemon 9.728 kB
Step 1 : FROM alpine:latest
 ---&gt; 0d81fc72e790
Step 2 : RUN apk add --update py-pip
 ---&gt; Running in 8abd4091b5f5
fetch http://dl-4.alpinelinux.org/alpine/v3.3/main/x86_64/APKINDEX.tar.gz
fetch http://dl-4.alpinelinux.org/alpine/v3.3/community/x86_64/APKINDEX.tar.gz
(1/12) Installing libbz2 (1.0.6-r4)
(2/12) Installing expat (2.1.0-r2)
(3/12) Installing libffi (3.2.1-r2)
(4/12) Installing gdbm (1.11-r1)
(5/12) Installing ncurses-terminfo-base (6.0-r6)
(6/12) Installing ncurses-terminfo (6.0-r6)
(7/12) Installing ncurses-libs (6.0-r6)
(8/12) Installing readline (6.3.008-r4)
(9/12) Installing sqlite-libs (3.9.2-r0)
(10/12) Installing python (2.7.11-r3)
(11/12) Installing py-setuptools (18.8-r0)
(12/12) Installing py-pip (7.1.2-r0)
Executing busybox-1.24.1-r7.trigger
OK: 59 MiB in 23 packages
 ---&gt; 976a232ac4ad
Removing intermediate container 8abd4091b5f5
Step 3 : COPY requirements.txt /usr/src/app/
 ---&gt; 65b4be05340c
Removing intermediate container 29ef53b58e0f
Step 4 : RUN pip install --no-cache-dir -r /usr/src/app/requirements.txt
 ---&gt; Running in a1f26ded28e7
Collecting Flask==0.10.1 (from -r /usr/src/app/requirements.txt (line 1))
  Downloading Flask-0.10.1.tar.gz (544kB)
Collecting Werkzeug&gt;=0.7 (from Flask==0.10.1-&gt;-r /usr/src/app/requirements.txt (line 1))
  Downloading Werkzeug-0.11.4-py2.py3-none-any.whl (305kB)
Collecting Jinja2&gt;=2.4 (from Flask==0.10.1-&gt;-r /usr/src/app/requirements.txt (line 1))
  Downloading Jinja2-2.8-py2.py3-none-any.whl (263kB)
Collecting itsdangerous&gt;=0.21 (from Flask==0.10.1-&gt;-r /usr/src/app/requirements.txt (line 1))
  Downloading itsdangerous-0.24.tar.gz (46kB)
Collecting MarkupSafe (from Jinja2&gt;=2.4-&gt;Flask==0.10.1-&gt;-r /usr/src/app/requirements.txt (line 1))
  Downloading MarkupSafe-0.23.tar.gz
Installing collected packages: Werkzeug, MarkupSafe, Jinja2, itsdangerous, Flask
  Running setup.py install for MarkupSafe
  Running setup.py install for itsdangerous
  Running setup.py install for Flask
Successfully installed Flask-0.10.1 Jinja2-2.8 MarkupSafe-0.23 Werkzeug-0.11.4 itsdangerous-0.24
You are using pip version 7.1.2, however version 8.1.1 is available.
You should consider upgrading via the &apos;pip install --upgrade pip&apos; command.
 ---&gt; 8de73b0730c2
Removing intermediate container a1f26ded28e7
Step 5 : COPY app.py /usr/src/app/
 ---&gt; 6a3436fca83e
Removing intermediate container d51b81a8b698
Step 6 : COPY templates/index.html /usr/src/app/templates/
 ---&gt; 8098386bee99
Removing intermediate container b783d7646f83
Step 7 : EXPOSE 5000
 ---&gt; Running in 31401b7dea40
 ---&gt; 5e9988d87da7
Removing intermediate container 31401b7dea40
Step 8 : CMD python /usr/src/app/app.py
 ---&gt; Running in 78e324d26576
 ---&gt; 2f7357a0805d
Removing intermediate container 78e324d26576
Successfully built 2f7357a0805d
</code></pre><p>如果你并没有alpine:3.5的镜像,客户端将会首先拉取这个镜像，然后再创建你的镜像.因此,你运行命令之后的输出可能会稍有不同.如果一切运行正常,你的镜像就应该创建准备完毕.运行<strong>docker images</strong> 命令查看你的镜像(<your_username>/myfirstapp)是否展示.</your_username></p>
<h3 id="运行你的镜像"><a href="#运行你的镜像" class="headerlink" title="运行你的镜像"></a>运行你的镜像</h3><p>下一步骤是运行你的镜像并且查看它是否正常工作.</p>
<pre><code>$ docker run -p 8888:5000 --name myfirstapp YOUR_USERNAME/myfirstapp
 * Running on http://0.0.0.0:5000/ (Press CTRL+C to quit)
</code></pre><p>访问 <a href="http://localhost:8888" target="_blank" rel="external">http://localhost:8888</a> 确认你的app是否存活.<br>注意: 如果你使用Docker Machine,你可能需要打开另一个终端并且使用<strong>docker-machine ip default</strong>命令来决定容器的ip地址.</p>
<p>点击在web浏览器的刷新按钮来查看更多猫的图片.</p>
<h3 id="推送你的镜像-push-your-image"><a href="#推送你的镜像-push-your-image" class="headerlink" title="推送你的镜像(push your image)"></a>推送你的镜像(push your image)</h3><p>现在你已经创建并且测试了你的镜像,你可以把它推送到<a href="https://cloud.docker.com/" target="_blank" rel="external">Docker Cloud</a>.</p>
<p>首先你必须登录到你的Docker Cloud 账户:</p>
<pre><code>docker login
</code></pre><p>输入你的用户名和密码然后执行如下命令:</p>
<pre><code>docker push YOUR_USERNAME/myfirstapp
</code></pre><p>现在你这个容器的工作以及完成了,停止并且移除它因为你不再需要再次使用它了.</p>
<p>打开另一个终端窗口并且执行如下命令:</p>
<pre><code>$ docker stop myfirstapp
$ docker rm myfirstapp
</code></pre><p>或者</p>
<pre><code>$ docker rm -f myfirstapp
</code></pre><h3 id="Dockerfile-命令总结"><a href="#Dockerfile-命令总结" class="headerlink" title="Dockerfile 命令总结"></a>Dockerfile 命令总结</h3><p>这是一个我们在Dockerfile中使用的基础命令的快速总结.</p>
<ul>
<li><p><strong>FROM</strong> 是Dockerfile的开头.Dockerfile必须以<strong>FROM</strong>命令开头.镜像是在layers中创建,这意味着你可以使用另一个镜像作为base镜像.<strong>FROM</strong>命令定义你的base layer.它将镜像的名称作为参数.你可以选择是否添加维护者的Docker Cloud用户名和镜像版本，以 username/imagename:version的格式.</p>
</li>
<li><p><strong>RUN</strong>是用来构建你创建的镜像.对于每个<strong>RUN</strong>命令来说，Docker将会运行这个命令然后为这个镜像创建新的layer.这种方式你可以你可以轻松回滚你的镜像到邻近的状态.<strong>RUN</strong>指令的语法是在RUN命令后放置shell命令(eg.,RUN mkdir /user/local/foo).这将会自动在一个 /bin/sh shell环境中运行.你可以像这样定义一个不同的shell:<strong>RUN /bin/bash -c ‘mkdir /user/local/foo’</strong></p>
</li>
<li><p>COPY 复制本地文件到容器当中.</p>
</li>
<li><p>CMD 定义在镜像启动阶段将会运行的命令.不同于<strong>RUN</strong>，这个命令不会为镜像创建新的layer,只是单纯的运行命令.每个Dockerfille/Image只能有一个<strong>CMD</strong>.如果你需要运行多个指令,最好的方式是用<strong>CMD</strong>运行一个script脚本.<strong>CMD</strong>需要你告诉它去哪里运行命令,不像<strong>RUN</strong>.示例如下:</p>
<pre><code>CMD [&quot;python&quot;, &quot;./app.py&quot;]

CMD [&quot;/bin/bash&quot;, &quot;echo&quot;, &quot;Hello World&quot;]
</code></pre></li>
<li><p>EXPOSE 为用户的镜像创建线索，比如ports提供服务.它包含了可以经由<strong>$ docker inspect <container-id></container-id></strong>命令恢复的所有信息.</p>
</li>
</ul>
<p>Note: <strong>EXPOSE</strong>命令实际上并不是让主机上的任何端口变得可访问!相反,这意味着需要通过使用 <strong> $ docker run -p</strong>命令在发布端口</p>
<ul>
<li>PUSH 推送你的镜像到Docker Cloud,或一个<a href="https://docs.docker.com/registry/" target="_blank" rel="external">私人的registry</a>.</li>
</ul>
<p>Note: 如果你想要了解更多关于Dockerfiles的内容,查看<a href="https://docs.docker.com/engine/userguide/eng-image/dockerfile_best-practices/" target="_blank" rel="external">Best practices for writing Dockerfiles</a></p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/docker/" rel="tag"># docker</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/02/12/部署一个app到Swarm上/" rel="next" title="3.0部署一个app到Swarm上">
                <i class="fa fa-chevron-left"></i> 3.0部署一个app到Swarm上
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/03/15/Docker Swarm 教程/" rel="prev" title="Docker Swarm 教程">
                Docker Swarm 教程 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
      <div id="lv-container" data-id="city" data-uid="MTAyMC8zMzEyMy85Njgy"></div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/uploads/avatar.png"
                alt="Hans Chung" />
            
              <p class="site-author-name" itemprop="name">Hans Chung</p>
              <p class="site-description motion-element" itemprop="description">A Salty Fish</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">37</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">19</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/darkleave" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#在容器中运行静态web网站"><span class="nav-number">1.</span> <span class="nav-text">在容器中运行静态web网站</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Docker-镜像"><span class="nav-number">2.</span> <span class="nav-text">Docker 镜像</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#创建你的首个镜像"><span class="nav-number">3.</span> <span class="nav-text">创建你的首个镜像</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#创建一个展示随机猫图片的Python-Flask-app"><span class="nav-number">3.1.</span> <span class="nav-text">创建一个展示随机猫图片的Python Flask app</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#app-py"><span class="nav-number">3.2.</span> <span class="nav-text">app.py</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#requirements-txt"><span class="nav-number">3.3.</span> <span class="nav-text">requirements.txt</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#templates-index-html"><span class="nav-number">3.4.</span> <span class="nav-text">templates/index.html</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#编写一个Dockerfile文件"><span class="nav-number">4.</span> <span class="nav-text">编写一个Dockerfile文件</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#构建镜像"><span class="nav-number">4.1.</span> <span class="nav-text">构建镜像</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#运行你的镜像"><span class="nav-number">4.2.</span> <span class="nav-text">运行你的镜像</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#推送你的镜像-push-your-image"><span class="nav-number">4.3.</span> <span class="nav-text">推送你的镜像(push your image)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Dockerfile-命令总结"><span class="nav-number">4.4.</span> <span class="nav-text">Dockerfile 命令总结</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Hans Chung</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  
    <script type="text/javascript">
      (function(d, s) {
        var j, e = d.getElementsByTagName(s)[0];
        if (typeof LivereTower === 'function') { return; }
        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;
        e.parentNode.insertBefore(j, e);
      })(document, 'script');
    </script>
  












  




  
  
  
  <link rel="stylesheet" href="/lib/algolia-instant-search/instantsearch.min.css">

  
  
  <script src="/lib/algolia-instant-search/instantsearch.min.js"></script>
  

  <script src="/js/src/algolia-search.js?v=5.1.4"></script>



  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("6vFOsvul8HaoNI6fiYReb3WW-gzGzoHsz", "O2fMHy7gRb7x2NsOSUY029TO");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  

  
  

  

  

  

</body>
</html>
